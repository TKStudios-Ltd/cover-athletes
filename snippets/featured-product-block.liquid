{%- assign product = product | default: block.settings.product -%}

<div class="featured-product__block featured-product__block--{{ block.type }}" {{ block.shopify_attributes }}>
  {% case block.type %}

    {% when 'media' %}
      {% if product and product.media.size > 0 %}
        <div class="featured-product__media-gallery">
          <div class="featured-product__media-gallery-main">
            {{ product.featured_media | image_url: width: 1200 | image_tag: loading: 'lazy' }}
          </div>

          {% if product.media.size > 1 %}
            <div class="featured-product__media-thumbs">
              {% for media in product.media %}
                <button
                  type="button"
                  class="featured-product__media-thumb"
                  data-media-id="{{ media.id }}"
                >
                  {{ media | image_url: width: 200 | image_tag: loading: 'lazy' }}
                </button>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% else %}
        {{ 'product-1' | placeholder_svg_tag }}
      {% endif %}

    {% when 'title' %}
      {% assign heading_tag = block.settings.heading_tag | default: 'h2' %}
      <{{ heading_tag }} class="featured-product__title">
        {{ product.title | escape }}
      </{{ heading_tag }}>

    {% when 'price' %}
      <div class="featured-product__price">
        {% render 'price', product: product %}
      </div>

    {% when 'text' %}
      {% if block.settings.text != blank %}
        <div class="featured-product__text rte">
          {{ block.settings.text }}
        </div>
      {% endif %}

    {% when 'variant_picker' %}
      {% if product and product.has_only_default_variant == false %}
        <div class="featured-product__form">
          {% form 'product', product, id: 'featured-product-form-' | append: section.id %}
            {% for option in product.options_with_values %}
              <div class="product-form__input product-form__input--dropdown">
                <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                  {{ option.name }}
                </label>
                <div class="select">
                  <select
                    id="Option-{{ section.id }}-{{ forloop.index0 }}"
                    class="featured-product__variant-select"
                    name="options[{{ option.name | escape }}]"
                  >
                    {% for value in option.values %}
                      <option
                        value="{{ value | escape }}"
                        {% if option.selected_value == value %}
                          selected
                        {% endif %}
                      >
                        {{ value }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            {% endfor %}

            <input
              type="hidden"
              name="id"
              value="{{ product.selected_or_first_available_variant.id }}"
            >
          {% endform %}
        </div>
      {% endif %}

    {% when 'buy_buttons' %}
      {% if product %}
        {% form 'product', product, id: 'featured-product-buttons-' | append: section.id %}
          <input
            type="hidden"
            name="id"
            value="{{ product.selected_or_first_available_variant.id }}"
          >
          <div class="featured-product__buttons">
            <button
              type="submit"
              name="add"
              class="button button--primary"
              {% unless product.selected_or_first_available_variant.available %}
                disabled
              {% endunless %}
            >
              {% if product.selected_or_first_available_variant.available %}
                {{ 'products.product.add_to_cart' | t }}
              {% else %}
                {{ 'products.product.sold_out' | t }}
              {% endif %}
            </button>

            {% if block.settings.show_dynamic_checkout and product.selling_plan_groups.size == 0 %}
              {{ form | payment_button }}
            {% endif %}
          </div>
        {% endform %}
      {% endif %}

  {% endcase %}
</div>
