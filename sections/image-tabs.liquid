{% comment %}
  Image Tabs — Ritual-compatible
  IMPORTANT:
  - No outer section/container wrappers (Ritual handles this)
  - All content must flow INSIDE the layout-panel-flex wrapper provided by section.liquid
{% endcomment %}

{% liquid
  if section.index == 1
    assign fetch_priority = 'high'
  else
    assign fetch_priority = 'auto'
  endif
%}

{%- style -%}

/* GRID: 50/50 on desktop, 1 column on mobile */
.image-tabs--{{ section.id }} {
  width: 100%;
  display: grid;
  grid-template-columns: 1fr;
  gap: 32px;
}

@media (min-width: 990px) {
  .image-tabs--{{ section.id }} {
    grid-template-columns: 1fr 1fr; /* 50/50 split */
  }
}

/* LEFT COLUMN --------------------------------------------- */
.image-tabs--{{ section.id }} .tabs-heading {
  margin-bottom: 20px;
}

.image-tabs--{{ section.id }} [data-tabs-list] {
  border-top: 1px solid rgba(0,0,0,.12);
  border-bottom: 1px solid rgba(0,0,0,.12);
}

.image-tabs--{{ section.id }} [data-tab-row] {
  position: relative;
  padding: 14px 0;
  cursor: pointer;
  border-bottom: 1px solid rgba(0,0,0,.12);
}

.image-tabs--{{ section.id }} [data-tab-row]:last-child {
  border-bottom: 0;
}

/* GREEN PILL (active indicator) ------------------------------------ */
.image-tabs--{{ section.id }} .tab-label {
  position: relative;
  font-size: clamp(28px, 5vw, 44px);
  font-weight: 600;
  display: inline-block;
  z-index: 2;
}

.image-tabs--{{ section.id }} .tab-label::before {
  content: "";
  position: absolute;
  inset: auto 0 0 0;
  height: 28px;
  border-radius: 1000px;
  background: {{ section.settings.pill_color }};
  transform: scaleX(0);
  transform-origin: left center;
  transition: transform .45s cubic-bezier(.22,1,.36,1);
  z-index: -1;
}

.image-tabs--{{ section.id }} [data-tab-row].is-active .tab-label::before {
  transform: scaleX(1);
}

/* RIGHT COLUMN — IMAGE SWIPER ----------------------------- */
.image-tabs--{{ section.id }} .img-swiper {
  position: relative;
  width: 100%;
}

.image-tabs--{{ section.id }} .swiper-slide {
  width: 100%;
}

.image-tabs--{{ section.id }} .slide-square {
  width: 100%;
  aspect-ratio: 1 / 1; /* ✅ Forces perfect square */
  overflow: hidden;
  border-radius: 16px;
}

.image-tabs--{{ section.id }} .slide-square img {
  width: 100%;
  height: 100%;
  object-fit: cover; /* ✅ Fits inside Ritual max-width */
  object-position: center;
  display: block;
}

/* Pagination */
.image-tabs--{{ section.id }} .swiper-pagination {
  position: absolute;
  bottom: 12px;
  right: 12px;
  left: auto;
}

{%- endstyle -%}


<div class="image-tabs--{{ section.id }}" data-component="image-tabs" data-section-id="{{ section.id }}">

  <!-- LEFT COLUMN -->
  <div>
    {% if section.settings.eyebrow %}
      <p class="tabs-heading">{{ section.settings.eyebrow }}</p>
    {% endif %}

    {% if section.settings.heading %}
      <h2 class="{{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>
    {% endif %}

    {% if section.settings.intro_text %}
      <div class="rte" style="margin-bottom:20px;">{{ section.settings.intro_text }}</div>
    {% endif %}

    <div data-tabs-list>
      {% for block in section.blocks %}
        <div data-tab-row data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          <span class="tab-label">{{ block.settings.title }}</span>
        </div>
      {% endfor %}
    </div>

    {% if section.settings.bottom_text %}
      <div class="rte" style="margin-top:20px;">{{ section.settings.bottom_text }}</div>
    {% endif %}
  </div>

  <!-- RIGHT COLUMN -->
  <div>
    <div id="Images-{{ section.id }}"
         class="swiper img-swiper"
         data-autoplay="{{ section.settings.autoplay }}"
         data-delay="{{ section.settings.autoplay_delay | times: 1000 }}"
    >
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          <div class="swiper-slide">
            <div class="slide-square">
              {% if block.settings.image %}
                {% assign widths = "600,900,1200,1600,2000" %}
                {% capture sizes %}(min-width:990px) 50vw, 100vw{% endcapture %}
                {{ block.settings.image | image_url: width: 2000 | image_tag: widths: widths, sizes: sizes, fetchpriority: fetch_priority }}
              {% else %}
                {{ 'lifestyle-1' | placeholder_svg_tag }}
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      <div class="swiper-pagination"></div>
    </div>
  </div>

</div>

{{ 'image-tabs.js' | asset_url | script_tag }}

{% schema %}
{
  "name": "Image Tabs",
  "settings": [
    { "type": "text", "id": "eyebrow", "label": "Subheading" },
    { "type": "inline_richtext", "id": "heading", "label": "Heading" },
    { "type": "select", "id": "heading_size", "label": "Heading size", "default": "h2", "options": [
      { "value": "h1", "label": "H1" },
      { "value": "h2", "label": "H2" },
      { "value": "h0", "label": "H0" }
    ]},
    { "type": "richtext", "id": "intro_text", "label": "Intro text" },
    { "type": "richtext", "id": "bottom_text", "label": "Text under tabs" },

    { "type": "checkbox", "id": "autoplay", "label": "Autoplay images", "default": true },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (seconds)", "min": 2, "max": 15, "default": 5 },

    { "type": "color", "id": "pill_color", "label": "Active pill color", "default": "#0FE694" }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "image_picker", "id": "image", "label": "Image" }
      ]
    }
  ],
  "presets": [
    { "name": "Image Tabs" }
  ]
}
{% endschema %}
