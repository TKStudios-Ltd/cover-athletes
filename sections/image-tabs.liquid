{% comment %} Image Tabs (Swiper-synced) â€” clean liquid, JS lives in assets/image-tabs.js {% endcomment %}

{{ 'component-image-with-text.css' | asset_url | stylesheet_tag }}

{%- style -%}
  
.image-tabs-{{ section.id }} { --gap: 32px; --pill: {{ section.settings.pill_color }}; }

.image-tabs-{{ section.id }} .grid {
    display: flex; gap: var(--gap);
    flex-wrap: wrap;
    flex-direction: row;
}
@media (min-width: 990px) {
    .image-tabs-{{ section.id }} .grid .image-tabs__tabs,
    .image-tabs-{{ section.id }} .grid .image-tabs__image { flex: 0 0 calc(50% - (var(--gap) / 2)); }
    .image-tabs-{{ section.id }}.reverse .grid { flex-direction: row-reverse; }
}
.image-tabs-{{ section.id }} .section-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
}
@media (min-width: 750px) {
    .image-tabs-{{ section.id }} .section-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
    }
}

  /* Eyebrow + copy */
  .image-tabs-{{ section.id }} .eyebrow {
    font-size: 12px; letter-spacing: .22em; text-transform: uppercase; opacity: .7; margin: 0 0 16px;
  }
  .image-tabs-{{ section.id }} .below-text { margin-top: 20px; opacity:.8; }

/* .image-tabs-{{ section.id }} .tabs {
    border-top: 1px solid rgba(255,255,255,.15);
    border-bottom: 1px solid rgba(255,255,255,.15);
} */
.image-tabs-{{ section.id }} .tabs .swiper-wrapper {
    display: flex; flex-direction: column; height: auto;
}
.image-tabs-{{ section.id }} .tab {
    display: grid; grid-template-columns: auto 1fr; gap: 12px; align-items: center;
    padding-block: 4px;
    cursor: pointer; user-select: none;
}
.image-tabs-{{ section.id }} .tab:last-child { border-bottom: 0; }

  /* Green pill that expands and pushes text */
  .image-tabs-{{ section.id }} .pill {
    height: 28px; width: 0; border-radius: 999px; background: var(--pill);
    transition: width .45s cubic-bezier(.22,.61,.36,1), transform .45s cubic-bezier(.22,.61,.36,1);
    transform-origin: left;
  }
  .image-tabs-{{ section.id }} .tab.is-active .pill { width: 56px; transform: scaleX(1); }

.image-tabs-{{ section.id }} .title {
    font-size: 28px !important;
    line-height: 1; text-decoration: none; color: rgb(var(--color-foreground)); padding-top: 4px;
    opacity: .25; transition: opacity .25s ease;
}
.image-tabs-{{ section.id }} .tab.is-active .title { opacity: 1; }

  /* Image pane: fixed 1:1 aspect, clipped */
  .image-tabs-{{ section.id }} .image-pane {
    position: relative; border-radius: 16px; overflow: hidden;
    /* 1:1 aspect ratio; height derives from width, stays in container */
    aspect-ratio: 1 / 1;
  }
  /* Make swiper take full pane size */
  .image-tabs-{{ section.id }} .image-pane .swiper,
  .image-tabs-{{ section.id }} .image-pane .swiper-wrapper,
  .image-tabs-{{ section.id }} .image-pane .swiper-slide {
    width: 100% !important; height: 100%;
  }
  .image-tabs-{{ section.id }} .image-slide .media { position: relative; width:100%; height:100%; }
  .image-tabs-{{ section.id }} .image-slide img {
    width: 100%; height: 100%; object-fit: cover; object-position: center center; display:block;
  }

  /* Pagination dots (vertical on desktop, centered row on mobile) */
  .image-tabs-{{ section.id }} .image-pagination {
    position: absolute; right: 12px; bottom: 16px; z-index: 3;
    display: flex; flex-direction: column; gap: 8px; width: 10px !important;
  }
  .image-tabs-{{ section.id }} .image-pagination .swiper-pagination-bullet {
    width: 10px; height: 10px; border-radius: 10px; opacity: .4; background: #fff !important;
    transition: height .2s ease, opacity .2s ease;
  }
  .image-tabs-{{ section.id }} .image-pagination .swiper-pagination-bullet-active {
    opacity: 1; height: 46px;
  }
  @media (max-width: 989px) {
    .image-tabs-{{ section.id }} .image-pagination {
      left: 0; right: 0; bottom: 10px; flex-direction: row; justify-content: center; width: auto !important;
    }
  }
{%- endstyle -%}

{% if section.index == 1 %}
    {% assign fetch_priority = "high" %}
  {% else %}
    {% assign fetch_priority = "auto" %}
{% endif %}

<section
  class="image-tabs-{{ section.id }} color-{{ section.settings.section_color_scheme }}{% if section.settings.layout == 'image_left' %} reverse{% endif %}"
  data-component="image-tabs"
  data-section-id="{{ section.id }}"
>
  <div class="section-padding">
    <div class="grid">
      <div class="image-tabs__tabs">
        {% if section.settings.eyebrow != blank %}
          <p class="eyebrow">{{ section.settings.eyebrow }}</p>
        {% endif %}
        {% if section.settings.heading != blank %}
          <h2 class="title inline-richtext {{ section.settings.heading_size }}" style="margin:0 0 16px">{{ section.settings.heading }}</h2>
        {% endif %}

        <div id="Tabs-{{ section.id }}" class="swiper tabs"
             data-autoplay="{{ section.settings.autoplay }}"
             data-delay="{{ section.settings.autoplay_delay | times: 1000 }}"
             data-loop="{{ section.settings.loop }}">
          <div class="swiper-wrapper">
            {% for block in section.blocks %}
              <div class="swiper-slide tab" {{ block.shopify_attributes }} data-index="{{ forloop.index0 }}" tabindex="0" role="button" aria-label="{{ block.settings.title | escape }}">
                <span class="pill" aria-hidden="true"></span>
                <a {% if block.settings.button_link == blank %} role="link" aria-disabled="true" {% else %} href="{{ block.settings.button_link }}" {% endif %} class="h3 title">
                  {{ block.settings.title }}
                </a>
              </div>
            {% endfor %}
          </div>
        </div>

        {% if section.settings.below_text != blank %}
          <div class="below-text rte">{{ section.settings.below_text }}</div>
        {% endif %}
      </div>

      <div class="image-tabs__image">
        <div id="Images-{{ section.id }}" class="swiper image-pane" data-space="{{ section.settings.image_gap }}">
          <div class="swiper-wrapper">
            {% for block in section.blocks %}
              <div class="swiper-slide image-slide">
                <div class="media">
                  {% if block.settings.image != blank %}
                    {% assign widths = '600, 900, 1200, 1600, 2000' %}
                    {% capture sizes %}(min-width: 1200px) 50vw, (min-width: 750px) 50vw, 100vw{% endcapture %}
                    {{ block.settings.image | image_url: width: 2000 | image_tag: widths: widths, sizes: sizes, fetchpriority: fetch_priority }}
                  {% else %}
                    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>

          <div class="swiper-pagination image-pagination"></div>
        </div>
      </div>

    </div>
  </div>
</section>

{% schema %}
{
  "name": "Image Tabs",
  "class": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "text", "id": "eyebrow", "label": "Subheading (eyebrow)", "default": "A new era of sports protection" },
    { "type": "inline_richtext", "id": "heading", "label": "Heading", "default": "Iconic design" },
    { "type": "select", "id": "heading_size", "label": "Heading size", "default": "h2", "options": [
      { "value": "h2", "label": "H2" }, { "value": "h1", "label": "H1" }, { "value": "h0", "label": "H0" }
    ]},
    { "type": "richtext", "id": "below_text", "label": "Text below tabs", "default": "<p>We exist to revolutionise protective sports equipment &amp; keep you playing the sport you love. Longer.</p>" },
    { "type": "select", "id": "layout", "label": "Layout (desktop)", "default": "image_right", "options": [
      { "value": "image_right", "label": "Image right" },
      { "value": "image_left",  "label": "Image left" }
    ]},
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (seconds)", "min": 2, "max": 15, "step": 1, "default": 5 },
    { "type": "checkbox", "id": "loop", "label": "Loop slides", "default": true },
    { "type": "range", "id": "image_gap", "label": "Image stack gap (px)", "min": 0, "max": 40, "step": 2, "default": 16 },
    { "type": "color", "id": "pill_color", "label": "Active pill color", "default": "#0FE694" },
    { "type": "color_scheme", "id": "section_color_scheme", "label": "Section color scheme", "default": "scheme-1" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Top padding", "default": 40 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 120, "step": 4, "unit": "px", "label": "Bottom padding", "default": 40 }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        { "type": "text", "id": "title", "label": "Title", "default": "Iconic Design" },
        { "type": "text", "id": "button_label", "label": "Button label" },
        { "type": "url",  "id": "button_link", "label": "Button link" },
        { "type": "image_picker", "id": "image", "label": "Image" }
      ]
    }
  ],
  "presets": [{ "name": "Image Tabs", "blocks": [{ "type": "tab" }, { "type": "tab" }, { "type": "tab" }] }]
}
{% endschema %}
