{% comment %} Testimonial Slider â€” JS in assets/testimonial-slider.js {% endcomment %}
{{ 'component-image-with-text.css' | asset_url | stylesheet_tag }}

{%- style -%}
/* ===== Shell ===== */
.testimonial-{{ section.id }} { position: relative; width: calc(100vw - 11px) !important; }
.testimonial-{{ section.id }} .slider-shell { position: relative; overflow: hidden; isolation: isolate; }

/* ===== BG Swiper ===== */
.testimonial-{{ section.id }} .bg-swiper,
.testimonial-{{ section.id }} .bg-swiper .swiper-wrapper,
.testimonial-{{ section.id }} .bg-swiper .swiper-slide { width:100%; height:100%; }
.testimonial-{{ section.id }} .bg-swiper { position:absolute; inset:0; z-index:1; }
.testimonial-{{ section.id }} .bg-media { position:absolute; inset:0; overflow:hidden; }
.testimonial-{{ section.id }} .bg-media img,
.testimonial-{{ section.id }} .bg-media video {
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block;
  transform:scale(1); transition:transform 1.2s ease;
}
.testimonial-{{ section.id }} .kenburns .bg-media img,
.testimonial-{{ section.id }} .kenburns .bg-media video { animation: kb-{{ section.id }} 10s ease forwards; }
@keyframes kb-{{ section.id }} { 0%{transform:scale(1)} 100%{transform:scale(1.05)} }

/* ===== Overlay ===== */
/* .testimonial-{{ section.id }} .overlay {
  position:absolute; inset:0; z-index:2;
  background: linear-gradient(90deg, rgba(0,0,0,.65) 0%, rgba(0,0,0,.35) 40%, rgba(0,0,0,.15) 64%, rgba(0,0,0,0) 100%);
  pointer-events:none;
} */

/* ===== Foreground content (left stack) ===== */
.testimonial-{{ section.id }} .content {
    position:relative; z-index:3; color:#fff;
    display:flex; flex-direction:column; 
    gap: 50px;
    width: 100%;
    height: 100%;
    align-items: flex-end;
    justify-content: flex-end;
    padding: 25px 25px 80px;
    min-height: 100vh;
    @media (max-width: 749px) {
      min-height: calc(100vh - 80px);
    }
}
.testimonial-{{ section.id }} .left-top { display:flex; align-items:center; gap:12px; }
.testimonial-{{ section.id }} .left-top img { height: 18px; width:auto; }
.testimonial-{{ section.id }} .eyebrow { font-size:14px; opacity:.95; }
.testimonial-{{ section.id }} .title { margin:28px 0 0; font-size: clamp(22px, 2.8vw, 28px); line-height:1.2; text-transform:uppercase; max-width: 480px; }

/* ===== Copy items (absolute stack with slide-up) ===== */
.testimonial-{{ section.id }} .copy-items { 
    position: relative;
    width: 50%;
    min-height: var(--copy-h, 0px); }
.testimonial-{{ section.id }} .copy-items .item { position:absolute; inset:0; opacity:0; pointer-events:none; }
.testimonial-{{ section.id }} .copy-items .item.is-active { opacity:1; pointer-events:auto; }
.testimonial-{{ section.id }} .slide-content { max-width:760px; }
.testimonial-{{ section.id }} .quote, .testimonial-{{ section.id }} .person { opacity:0; transform:translateY(10px); }
.testimonial-{{ section.id }} .copy-items .item.is-active .quote { animation: copyIn-{{ section.id }} .45s ease forwards; }
.testimonial-{{ section.id }} .copy-items .item.is-active .person { animation: copyIn-{{ section.id }} .45s ease .14s forwards; }
@keyframes copyIn-{{ section.id }} { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }
.testimonial-{{ section.id }} h3.quote { 
    font-family: 'Graphik', sans-serif !important;
    font-weight: 500 !important;
    font-size: 44px; 
    text-transform: inherit !important;
    letter-spacing: -0.5px;
    line-height: 1; 
}
.testimonial-{{ section.id }} .person { margin-top:22px; font-size: clamp(14px, 1.8vw, 16px); opacity:.9; }

/* ===== Pager with progress ===== */
.testimonial-{{ section.id }} .pager {
    display: flex;
    gap: 40px;
    align-items: flex-start;
    margin-top: 50px;
    flex-wrap: wrap;
}
.testimonial-{{ section.id }} .pager__item {
  cursor:pointer;
  min-width: 160px;
  background:none;
  border:none;
  padding:0;
  text-align:left;
  color:inherit;
}
.testimonial-{{ section.id }} .pager__bar {
  position:relative; height:1px; width:100%;
  background: rgba(255,255,255,.25); border-radius:1px; overflow:hidden;
}
.testimonial-{{ section.id }} .pager__bar::after {
  content:''; position:absolute; inset:0 100% 0 0; background:#fff; opacity:.95;
}

/* Name and role under line */
.testimonial-{{ section.id }} .pager__label {
  margin-top: 10px;
  font-size:  16px;
  letter-spacing: -0.2px;
  opacity: 0.6;
}
.testimonial-{{ section.id }} .pager__name { display:block; opacity: 1; font-weight: 600; }
.testimonial-{{ section.id }} .pager__role { display:block; opacity: 1; font-weight: 400; margin-top: 2px; }

.testimonial-{{ section.id }} .pager__item.is-active .pager__label { opacity:1; }

/* keyframes controlled by inline var(--delay-ms) */
@keyframes tl-fill-{{ section.id }} { from { inset:0 100% 0 0; } to { inset:0 0 0 0; } }
.testimonial-{{ section.id }} .pager__item.is-anim .pager__bar::after {
  animation: tl-fill-{{ section.id }} var(--delay-ms, 5000ms) linear forwards;
}

/* Full width inside section wrappers */
.section .testimonial-{{ section.id }} { width:100%; }
{%- endstyle -%}

<section
  class="testimonial-{{ section.id }} color-{{ section.settings.color_scheme }}"
  data-component="testimonial-slider"
  data-section-id="{{ section.id }}"
>
  <div
    class="slider-shell{% if section.settings.ken_burns %} kenburns{% endif %}"
    data-effect="{{ section.settings.effect }}"
    data-autoplay="{{ section.settings.autoplay }}"
    data-delay="{{ section.settings.delay | times: 1000 }}"
    data-loop="{{ section.settings.loop }}"
  >
    <!-- BG Swiper -->
    <div id="TestimonialBg-{{ section.id }}" class="swiper bg-swiper">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          {% if block.type == 'slide' %}
          <div class="swiper-slide" {{ block.shopify_attributes }}>
            <div class="bg-media">
              {% if block.settings.video != blank %}
                {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, playsinline: true }}
              {% elsif block.settings.image != blank %}
                {% assign widths = '1200,1600,2000,2400,3000' %}
                {% capture sizes %}100vw{% endcapture %}
                {{ block.settings.image | image_url: width: 3000 | image_tag: widths: widths, sizes: sizes, loading: 'lazy' }}
              {% else %}
                {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
              {% endif %}
            </div>
          </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>

    <div class="overlay"></div>

    <!-- Foreground -->
    <div class="content">
      <div class="slider-top">
        {% if section.settings.label_icon != blank or section.settings.eyebrow != blank %}
          <div class="left-top">
            {% if section.settings.label_icon != blank %}
              {{ section.settings.label_icon | image_url: width: 140 | image_tag: loading: 'lazy' }}
            {% endif %}
            {% if section.settings.eyebrow != blank %}
              <div class="eyebrow">{{ section.settings.eyebrow }}</div>
            {% endif %}
          </div>
        {% endif %}
        {% if section.settings.title != blank %}
          <h2 class="title inline-richtext {{ section.settings.title_size }}">{{ section.settings.title }}</h2>
        {% endif %}
      </div>

      <!-- Copy -->
      <div id="TestimonialCopy-{{ section.id }}" class="copy-items">
        {% for block in section.blocks %}
        {% if block.type == 'slide' %}
          <div class="item{% if forloop.first %} is-active{% endif %}" data-slide="{{ forloop.index0 }}">
            <div class="slide-content">
              {% if block.settings.quote != blank %}
                <h3 class="quote rte">{{ block.settings.quote }}</h3>
              {% endif %}
            </div>
          </div>
        {% endif %}
        {% endfor %}
      </div>

      <!-- Pager with progress + Name/Role -->
      <div class="pager" id="TestimonialPager-{{ section.id }}" style="--delay-ms: {{ section.settings.delay | times: 1000 }}ms">
        {% for block in section.blocks %}
        {% if block.type == 'slide' %}
          <button class="pager__item{% if forloop.first %} is-active{% endif %}" data-idx="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
            <div class="pager__bar"></div>
            <div class="pager__label">
              {% if block.settings.person_name != blank %}
                <span class="pager__name">{{ block.settings.person_name }}</span>
              {% endif %}
              {% if block.settings.person_title != blank %}
                <span class="pager__role">{{ block.settings.person_title }}</span>
              {% endif %}
            </div>
          </button>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Testimonial Slider",
  "class": "section",
  "disabled_on": { "groups": ["header","footer"] },
  "settings": [
    { "type": "image_picker", "id": "label_icon", "label": "Small icon (left label)" },
    { "type": "text", "id": "eyebrow", "label": "Subtitle (left label)", "default": "Cover Athletes" },
    { "type": "inline_richtext", "id": "title", "label": "Title", "default": "Real Athletes. Real Stories." },
    { "type": "select", "id": "title_size", "label": "Title size", "default": "h1", "options": [
      { "value": "h3", "label": "H3" }, { "value": "h2", "label": "H2" }, { "value": "h1", "label": "H1" }, { "value": "h0", "label": "H0" }
    ]},

    { "type": "checkbox", "id": "ken_burns", "label": "Subtle Ken Burns zoom", "default": true },
    { "type": "select", "id": "effect", "label": "Transition effect", "default": "slide", "options": [
      { "value": "slide", "label": "Slide" },
      { "value": "fade", "label": "Fade (background only)" }
    ]},
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "delay", "label": "Autoplay delay (sec)", "min": 3, "max": 15, "step": 1, "default": 5 },
    { "type": "checkbox", "id": "loop", "label": "Loop", "default": true },

    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Background image" },
        { "type": "video", "id": "video", "label": "Background video (optional)" },
        { "type": "richtext", "id": "quote", "label": "Quote/content", "default": "<p>I have faced 150kph bouncers and never thought twice because I trust what is protecting me.</p>" },
        { "type": "text", "id": "person_name", "label": "Name", "default": "Glenn Phillips" },
        { "type": "text", "id": "person_title", "label": "Role", "default": "New Zealand Cricketer" }
      ]
    }
  ],
  "presets": [
    { "name": "Testimonial Slider", "blocks": [{ "type": "slide" }, { "type": "slide" }, { "type": "slide" }] }
  ]
}
{% endschema %}
