{% comment %}
  R&D Slider â€” fixed-width cards (NOT full width), per-block color schemes,
  custom drag cursor, autoplay handled in rd-slider.js
{% endcomment %}

{%- style -%}
.rd-slider {
  width: 100%;
  overflow: hidden;
}

.rd-slider .swiper {
  width: 100%;
}

.rd-slider .swiper-wrapper {
  display: flex;
  align-items: stretch;
}

.rd-slide {
  width: 320px; /* match design */
  flex-shrink: 0;
  position: relative;
  cursor: url("{{ 'cursor-drag.svg' | asset_url }}") 20 20, grab;
}

@media (min-width: 750px) {
  .rd-slide { width: 380px; }
}

@media (min-width: 1200px) {
  .rd-slide { width: 420px; }
}

.rd-slide:active {
  cursor: grabbing;
}

.rd-slide__media {
  position: relative;
  overflow: hidden;
  border-radius: 14px;
}

.rd-ratio--square { aspect-ratio: 1 / 1; }
.rd-ratio--tall { aspect-ratio: 3 / 4; }

.rd-slide__media img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ----- Per-block color schemes ----- */
.rd-slide.color-scheme-1 { --overlay: rgba(0,0,0,0.25); --text: #fff; }
.rd-slide.color-scheme-2 { --overlay: rgba(255,255,255,0.15); --text: #000; }
/* Add more if needed */

.rd-slide__overlay {
  position: absolute;
  inset: 0;
  background: var(--overlay);
  border-radius: 14px;
}

.rd-slide__content {
  position: absolute;
  inset: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  pointer-events: none;
}

.rd-slide__title {
  font-size: 22px;
  font-weight: 600;
  color: var(--text);
  max-width: 75%;
  line-height: 1.2;
}

.rd-slide__button {
  pointer-events: auto;
  display: inline-block;
  padding: 8px 14px;
  background: var(--text);
  color: #000;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  text-decoration: none;
}

.rd-slide__icon {
  position: absolute;
  right: 20px;
  bottom: 20px;
  width: 48px;
  height: 48px;
}

.rd-slide__icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}
{%- endstyle -%}

<section
  class="rd-slider"
  data-rd-slider
  data-autoplay="{{ section.settings.autoplay }}"
  data-delay="{{ section.settings.delay | times: 1000 }}"
>
  <div id="rd-swiper-{{ section.id }}" class="swiper rd-slider__inner">
    <div class="swiper-wrapper">

      {% for block in section.blocks %}
      <div
        class="swiper-slide rd-slide color-{{ block.settings.color_scheme }}"
        {{ block.shopify_attributes }}
      >
        <div class="rd-slide__media rd-ratio--{{ block.settings.ratio }}">
          {% if block.settings.image %}
            {{ block.settings.image | image_url: width: 2000 | image_tag }}
          {% else %}
            {{ 'image' | placeholder_svg_tag }}
          {% endif %}
        </div>

        <div class="rd-slide__overlay"></div>

        <div class="rd-slide__content">

          {% if block.settings.title %}
            <h3 class="rd-slide__title">{{ block.settings.title }}</h3>
          {% endif %}

          {% if block.settings.link %}
            <a href="{{ block.settings.link }}" class="rd-slide__button">
              {{ block.settings.link_label | default: "Learn more" }}
            </a>
          {% endif %}

          {% if block.settings.icon %}
            <div class="rd-slide__icon">
              {{ block.settings.icon | image_url: width: 80 | image_tag }}
            </div>
          {% endif %}

        </div>
      </div>
      {% endfor %}

    </div>
  </div>
</section>

{% schema %}
{
  "name": "R&D Slider",
  "settings": [
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "delay", "label": "Autoplay delay (sec)", "min": 2, "max": 12, "step": 1, "default": 5 }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "select", "id": "ratio", "label": "Slide ratio", "default": "square", "options": [
          { "value": "square", "label": "1:1" },
          { "value": "tall", "label": "3:4" }
        ]},
        { "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1", "options": [
          { "value": "scheme-1", "label": "Scheme 1" },
          { "value": "scheme-2", "label": "Scheme 2" }
        ]},
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "url", "id": "link", "label": "Link URL" },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "Learn more" },
        { "type": "image_picker", "id": "icon", "label": "Bottom-right icon" }
      ]
    }
  ],
  "presets": [{ "name": "R&D Slider" }]
}
{% endschema %}
